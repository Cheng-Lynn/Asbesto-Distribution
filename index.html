<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- leaflet css link  -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    />
     <!--bootstrap css-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" 
  integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" 
  crossorigin="anonymous"/>
    
  <title>Asbestos Distribution</title>

    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        width: 100%;
        height: 100vh;
        z-index: 100;
      }
    </style>
  </head>
  
  <body>

    <div id="head" class="col-md-12">
        <h3 class="text-center" ><span style="color: maroon;padding: inherit;font-size: 24pt;
        font-weight: 900;text-align: center;">Asbestos Prevalence Across Kenyan Counties </h3>

        <p>

    <div id="map"></div>

    <!-- leaflet js link  -->
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

<!-- jquery link  -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Locate.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet-control-geocoder.Geocoder.js"></script>
        <script src="js/leaflet.ajax.min.js"></script>
        <!-- <script src="data/Counties2.json"></script> -->
        <script src="js/Leaflet.SLD-master/leaflet.sld.js"></script>
        



<script>
  var map = L.map("map").setView([-0.9, 39],6.4);

  var osm = L.tileLayer('https://api.maptiler.com/maps/openstreetmap/{z}/{x}/{y}.jpg?key=iWG4UVE2Fx4REa9qTLto', { 
            attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',
        });
        
        osm.addTo(map);
  


        function pop_Asbestos_Distr(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (i in e.target._eventParents) {
                        e.target._eventParents[i].resetStyle(e.target);
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });

          var popupContent = '<table>\
          \
            <tr>\
                <th scope="row">COUNTY</th>\
                <td>' + (feature.properties['COUNTY'] !== null ? autolinker.link(feature.properties['COUNTY'].toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Shape_Area</th>\
                <td>' + (feature.properties['Shape_Area'] !== null ? autolinker.link(feature.properties['Shape_Area'].toLocaleString()) : '') + '</td>\
            </tr>\
            <tr>\
                <th scope="row">Asbestos</th>\
                <td>' + (feature.properties['Asbestos'] !== null ? autolinker.link(feature.properties['Asbestos'].toLocaleString()) : '') + '</td>\
            </tr>\
        </table>';
       '<br/><a href="https://endelevu.africa/project/9" target="_blank">View this Project</a>';

    layer.bindPopup(popupContent, {maxHeight: 400});

        }
        
          [ './asbestos/'].forEach(path => {
         const mapDiv = document.createElement('div');
         mapDiv.classList.add('map');
         document.body.appendChild(mapDiv)
         
         const dataJson = fetch(`${path}data.geojson`);
         const dataSld = fetch(`${path}data.sld`);
         Promise.all([dataJson, dataSld]).then(([jsonResponse, sldResponse]) => {
            return Promise.all([jsonResponse.json(), sldResponse.text()])
               .then(([geoJson, sldText]) => {
                  const SLDStyler = new L.SLDStyler(sldText);
                  const geojsonLayer = L.geoJson(geoJson, {
                     style: SLDStyler.getStyleFunction(),
                     pointToLayer: SLDStyler.getPointToLayerFunction()
                    .bindTooltip(feature.properties.COUNTY);
                    }).bindPopup(function (layer) {
   return layer.feature.properties.popupContent;
                  }).addTo(map);
                  map.fitBounds(geojsonLayer.getBounds());
               });
         })
      });
  //endelevu watermark
 L.Control.Watermark=L.Control.extend({
            onAdd: function(map){
                var img= L.DomUtil.create('img');
                img.src= 'https://endelevu.africa/assets/img/endelevu_large_logo.jpg';
                img.style.width= '153px';
                return img;
            },
            onRemove:function(map){},
        });

            L.control.watermark=function(opts){
                return new L.Control.Watermark(opts)
            }
            L.control.watermark({
                position:'bottomright',
                background:'#4cd137',
            }).addTo(map);  
    
     var osmGeocoder = new L.Control.Geocoder({
            collapsed: true,
            position: 'topleft',
            target: 'abc',
            text: 'Search',
            title: 'Testing'
        }).addTo(map);
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
        .className += ' fa fa-search';
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
        .title += 'Search';
  
  
    </script>
  </body>
</html>
